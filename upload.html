<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 분석 업로더</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f7f6; }
        .container { max-width: 600px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        #uploadForm { display: flex; flex-direction: column; gap: 15px; }
        #uploadButton { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        #uploadButton:hover { background-color: #0056b3; }
        #statusMessage { margin-top: 20px; padding: 15px; border-radius: 4px; font-weight: bold; border: 1px solid #ccc; background-color: #e9ecef; }
        #descriptionOutput { margin-top: 20px; padding: 15px; border-left: 5px solid #28a745; background-color: #e6ffed; font-size: 1.1em; }
    </style>
</head>
<body>

    <div class="container">
        <h2>📷 이미지 분석 및 업로드</h2>
        
        <div id="uploadForm">
            <label for="imageFile">분석할 이미지를 선택하세요:</label>
            <input type="file" id="imageFile" accept="image/*">
            <button id="uploadButton">이미지 분석 요청</button>
        </div>
    
        <div id="statusMessage">상태: 파일을 선택하고 요청 버튼을 눌러주세요.</div>
    
        <div id="descriptionOutput">분석 결과가 여기에 표시됩니다.</div>
    </div>

    <script>
        // 🚨 중요: 백엔드 API 주소와 엔드포인트를 여기에 맞게 수정하세요.
        const API_ENDPOINT = 'http://localhost:8080/upload'; 

        const fileInput = document.getElementById('imageFile');
        const uploadButton = document.getElementById('uploadButton');
        const statusMessage = document.getElementById('statusMessage');
        const descriptionOutput = document.getElementById('descriptionOutput');

        uploadButton.addEventListener('click', handleUpload);

        async function handleUpload() {
            // 초기 상태 초기화
            descriptionOutput.textContent = '분석 결과가 여기에 표시됩니다.';
            descriptionOutput.style.borderLeftColor = '#28a745';
            
            const file = fileInput.files[0];
            if (!file) {
                statusMessage.textContent = '상태: 🛑 파일을 먼저 선택해야 합니다.';
                statusMessage.style.backgroundColor = 'yellow';
                return;
            }

            // 업로드 시작 시 상태 표시
            statusMessage.textContent = `상태: 🚀 파일 "${file.name}" 업로드 및 분석 요청 중...`;
            statusMessage.style.backgroundColor = 'lightblue';

            // 1. 파일 전송을 위한 FormData 객체 생성
            const formData = new FormData();
            // 키 이름 'image'는 백엔드가 파일을 식별하는 데 사용합니다.
            formData.append('image', file); 

            try {
                // 2. fetch API를 사용해 백엔드에 POST 요청 전송
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    // FormData를 사용하므로 Content-Type은 브라우저가 자동(multipart/form-data) 설정
                    body: formData,
                });

                // 3. 응답 처리
                if (response.ok) {
                    const result = await response.json();
                    
                    // 백엔드가 JSON 응답에서 'description' 키로 설명을 보냈다고 가정
                    const imageDescription = result.description || "백엔드에서 유효한 설명을 받지 못했습니다.";

                    statusMessage.textContent = '상태: ✅ 업로드 및 분석 성공!';
                    statusMessage.style.backgroundColor = 'lightgreen';
                    
                    // 4. 추출한 설명을 화면에 표시
                    descriptionOutput.textContent = `[분석 결과] ${imageDescription}`; 
                    
                    console.log('백엔드 응답 전체:', result);

                } else {
                    // HTTP 상태 코드 4xx, 5xx 에러 처리
                    const errorText = await response.text();
                    statusMessage.textContent = `상태: ❌ 업로드 실패. 코드: ${response.status}. 백엔드 응답: ${errorText}`;
                    statusMessage.style.backgroundColor = 'lightcoral';
                    descriptionOutput.textContent = '이미지 분석에 실패했습니다. 서버 로그를 확인하세요.';
                    descriptionOutput.style.borderLeftColor = 'red';
                }
            } catch (error) {
                // 네트워크 오류 (예: 서버가 연결되지 않음, CORS 문제 등)
                statusMessage.textContent = `상태: 💥 네트워크 오류 발생. 서버가 실행 중인지 확인하세요. (${error.message})`;
                statusMessage.style.backgroundColor = 'lightcoral';
                descriptionOutput.textContent = '네트워크 연결 오류로 서버에 접속할 수 없습니다.';
                descriptionOutput.style.borderLeftColor = 'red';
                console.error('Fetch Error:', error);
            }
        }
    </script>

</body>
</html>